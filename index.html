<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Esfiharia Sabor</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" crossorigin href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet">
    
    <style>
      :root{--primary:#f45925;--bg-light:#ffffff;--bg-dark:#221410}
      body{font-family:'Plus Jakarta Sans',sans-serif;min-height:100vh;background-color: var(--bg-light);}
      .material-symbols-outlined{font-variation-settings:'FILL' 0,'wght' 400,'GRAD' 0,'opsz' 24}
      .hide-scrollbar::-webkit-scrollbar{display:none}
      .hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}
      .fade-in { animation: fadeIn 0.3s ease-in-out; }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
      .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

      /* --- ESTILO DE IMPRESS√ÉO (CUPOM T√âRMICO) --- */
      @media print {
        body * {
          visibility: hidden;
          height: 0;
          overflow: hidden;
        }
        #printable-area, #printable-area * {
          visibility: visible;
          height: auto;
        }
        #printable-area {
          position: absolute;
          left: 0;
          top: 0;
          width: 100%;
          font-family: 'Courier New', Courier, monospace; /* Fonte Monospace para alinhar */
          font-size: 13px; /* Tamanho bom para 58mm/80mm */
          color: black;
          background: white;
          padding: 0;
          margin: 0;
        }
        .no-print { display: none !important; }
      }
    </style>
  </head>
  <body class="text-[#181311]">
    
    <div id="app-content" class="w-full max-w-5xl mx-auto min-h-screen flex flex-col bg-white overflow-hidden relative border-x border-gray-50 no-print">
      
      <header class="sticky top-0 z-30 bg-white/95 backdrop-blur-sm p-4 flex items-center justify-between border-b shadow-sm">
        <div class="flex items-center gap-2 cursor-pointer" onclick="showSection('home-section')">
          <span class="material-symbols-outlined text-3xl text-[#f45925]">local_pizza</span>
          <h1 class="text-lg font-bold text-[#f45925]">Esfiharia Sabor</h1>
        </div>
        <div class="flex items-center gap-2">
          <button id="btn-menu" class="hidden md:block px-3 py-1 rounded-full text-sm font-semibold text-gray-600 hover:bg-gray-100">Card√°pio</button>
          <button id="btn-cart" class="relative p-2 rounded-full hover:bg-gray-100 transition" aria-label="Carrinho">
            <span class="material-symbols-outlined text-2xl text-gray-700">shopping_cart</span>
            <span id="cart-count" class="hidden absolute top-0 right-0 bg-[#f45925] text-white rounded-full text-[10px] w-5 h-5 flex items-center justify-center font-bold shadow-sm">0</span>
          </button>
        </div>
      </header>

      <main class="flex-1 overflow-y-auto bg-white">
        
        <section id="home-section" class="space-y-6 p-4 pb-20 bg-white">
          <div class="flex flex-col items-center text-center pt-10">
            <img src="https://t4.ftcdn.net/jpg/04/30/70/67/360_F_430706799_y9oKooR7hz7vYb8qm7e9gRUZkID0PfYD.jpg" 
                 class="w-40 h-40 rounded-full object-cover shadow-xl border-4 border-white mb-6" alt="Logo">
            
            <h2 class="text-3xl font-extrabold text-gray-800 tracking-tight">O Verdadeiro Sabor<br>da Esfiha!</h2>
            <p class="text-gray-500 pt-3 px-4 leading-relaxed max-w-md">Massas frescas, recheios generosos e entrega r√°pida no conforto da sua casa.</p>
          </div>
          <div class="pt-4 px-4 max-w-md mx-auto">
            <button id="cta-menu" class="w-full bg-[#f45925] hover:bg-[#d6421b] text-white rounded-2xl py-4 font-bold text-lg shadow-lg shadow-orange-200 transition-all transform hover:scale-[1.02]">
              Fazer Pedido Delivery
            </button>
          </div>
        </section>

        <section id="menu-section" class="hidden flex flex-col h-full">
          <div class="sticky top-0 z-20 bg-white/95 backdrop-blur pt-4 pb-4 px-4 border-b border-gray-200">
            <div class="flex gap-2 overflow-x-auto hide-scrollbar justify-start md:justify-center">
              <button onclick="setCategory('salgadas')" id="tab-salgadas" class="cat-btn px-6 py-2 rounded-full bg-[#f45925] text-white text-sm font-bold whitespace-nowrap shadow-md transition-all">Salgadas</button>
              <button onclick="setCategory('doces')" id="tab-doces" class="cat-btn px-6 py-2 rounded-full bg-white text-gray-600 text-sm font-bold whitespace-nowrap shadow-sm border border-gray-200 hover:bg-gray-50 transition-all">Doces</button>
              <button onclick="setCategory('bebidas')" id="tab-bebidas" class="cat-btn px-6 py-2 rounded-full bg-white text-gray-600 text-sm font-bold whitespace-nowrap shadow-sm border border-gray-200 hover:bg-gray-50 transition-all">Bebidas</button>
              <button onclick="setCategory('combos')" id="tab-combos" class="cat-btn px-6 py-2 rounded-full bg-white text-gray-600 text-sm font-bold whitespace-nowrap shadow-sm border border-gray-200 hover:bg-gray-50 transition-all">Combos</button>
            </div>
          </div>

          <div id="products" class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4 pb-32 max-w-4xl mx-auto w-full"></div>
        </section>

        <section id="cart-section" class="hidden p-4 pb-20 max-w-2xl mx-auto">
          <div class="flex items-center gap-2 mb-6 cursor-pointer" onclick="showSection('menu-section')">
             <span class="material-symbols-outlined text-gray-500">arrow_back</span>
             <h2 class="text-2xl font-bold">Seu Pedido</h2>
          </div>
          
          <div id="cart-items" class="space-y-3 mb-8"></div>
          
          <div class="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
            
            <div class="flex justify-between mb-2 text-gray-600">
              <span>Subtotal</span>
              <span id="subtotal" class="font-semibold">R$ 0,00</span>
            </div>
            <div class="flex justify-between mb-6 pt-4 border-t border-gray-100">
              <span class="text-xl font-bold text-gray-800">Total</span>
              <span id="total" class="text-2xl font-bold text-[#f45925]">R$ 0,00</span>
            </div>
            
            <div class="space-y-5 mb-6 border-t pt-5">
              
              <h3 class="font-bold text-gray-800 mb-2">Tipo de Pedido</h3>
              <div class="grid grid-cols-2 gap-4">
                  <button id="btn-delivery" onclick="setOrderType('delivery')" class="p-4 rounded-xl border-2 border-[#f45925] bg-[#f45925] text-white font-bold flex flex-col items-center gap-2 transition-all shadow-md">
                      <span class="material-symbols-outlined text-3xl">motorcycle</span>
                      Entrega
                  </button>
                  <button id="btn-pickup" onclick="setOrderType('pickup')" class="p-4 rounded-xl border border-gray-200 bg-white text-gray-500 font-bold flex flex-col items-center gap-2 hover:bg-gray-50 transition-all">
                      <span class="material-symbols-outlined text-3xl">storefront</span>
                      Retirada
                  </button>
              </div>

              <div>
                <label class="block text-sm font-bold text-gray-700 mb-1">Seu Nome <span class="text-red-500">*</span></label>
                <input id="customer-name" type="text" class="w-full rounded-xl border-gray-300 bg-gray-50 focus:bg-white shadow-sm focus:border-[#f45925] focus:ring-[#f45925] py-3" placeholder="Digite seu nome" />
              </div>

              <div id="delivery-address-group" class="space-y-4 fade-in">
                  <div class="flex items-center gap-2 mb-2 pt-2 border-t">
                    <span class="material-symbols-outlined text-[#f45925]">location_on</span>
                    <h3 class="font-bold text-gray-800">Endere√ßo de Entrega</h3>
                  </div>
                  
                  <div class="flex items-center gap-3 p-3 bg-orange-50 rounded-xl border border-orange-100">
                      <input type="checkbox" id="rural-check" onchange="toggleRural()" class="w-5 h-5 text-[#f45925] border-gray-300 rounded focus:ring-[#f45925]">
                      <label for="rural-check" class="text-sm font-bold text-gray-700 cursor-pointer select-none">Moro em Zona Rural / S√≠tio <br><span class="text-xs font-normal text-gray-500">N√£o tenho endere√ßo com CEP/Rua</span></label>
                  </div>

                  <div id="info-entrega" class="mt-3 bg-gray-50 border border-gray-200 p-3 rounded-xl flex items-center justify-between">
                        <div class="flex items-center gap-2 text-gray-800">
                            <span class="material-symbols-outlined">timer</span>
                            <div class="flex flex-col">
                                <span class="text-xs font-bold uppercase opacity-70">Tempo Estimado</span>
                                <span class="font-bold">30-40 min</span>
                            </div>
                        </div>
                        <div class="flex items-center gap-2 text-gray-800">
                            <span class="material-symbols-outlined">two_wheeler</span>
                            <div class="flex flex-col text-right">
                                <span class="text-xs font-bold uppercase opacity-70">Taxa de Entrega</span>
                                <span id="valor-entrega" class="font-bold">A combinar</span>
                            </div>
                        </div>
                  </div>

                  <div id="urban-address-fields" class="space-y-4">
                      <div>
                        <div class="flex justify-between items-center mb-1">
                            <label class="block text-sm font-bold text-gray-700">CEP</label>
                            <button type="button" onclick="enableManualAddress()" class="text-xs font-bold text-[#f45925] hover:underline">
                                N√£o sei meu CEP
                            </button>
                        </div>
                        <input id="address-cep" type="text" onblur="buscarCep()" maxlength="9" class="w-full rounded-xl border-gray-300 bg-gray-50 focus:bg-white shadow-sm focus:border-[#f45925] focus:ring-[#f45925] py-3 text-lg transition-all" placeholder="00000-000" />
                        <p id="cep-error" class="text-xs text-red-500 mt-1 hidden">CEP n√£o encontrado.</p>
                      </div>

                      <div class="grid grid-cols-3 gap-3">
                        <div class="col-span-2">
                          <label class="block text-sm font-bold text-gray-700 mb-1">Rua <span class="text-red-500">*</span> </label>
                          <input id="address-street" type="text" class="w-full rounded-xl border-gray-300 bg-gray-100 text-gray-500 transition-all" readonly placeholder="Rua..." />
                        </div>
                        <div>
                          <label class="block text-sm font-bold text-gray-700 mb-1">N√∫mero <span class="text-red-500">*</span></label>
                          <input id="address-number" type="number" class="w-full rounded-xl border-gray-300 bg-gray-50 focus:bg-white shadow-sm focus:border-[#f45925] focus:ring-[#f45925]" placeholder="Ex: 10" />
                        </div>
                      </div>

                      <div class="grid grid-cols-2 gap-3">
                        <div>
                          <label class="block text-sm font-bold text-gray-700 mb-1">Bairro <span class="text-red-500">*</span></label>
                          <input id="address-district" type="text" class="w-full rounded-xl border-gray-300 bg-gray-100 text-gray-500 transition-all" readonly placeholder="Bairro" />
                        </div>
                        <div>
                          <label class="block text-sm font-bold text-gray-700 mb-1">Cidade <span class="text-red-500">*</span></label>
                          <input id="address-city" type="text" class="w-full rounded-xl border-gray-300 bg-gray-100 text-gray-500" readonly placeholder="Cidade" />
                        </div>
                      </div>
                      
                      <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">Complemento / Ref.</label>
                        <input id="address-complement" type="text" class="w-full rounded-xl border-gray-300 bg-gray-50 focus:bg-white shadow-sm focus:border-[#f45925] focus:ring-[#f45925] py-2" placeholder="Ex: Apto 102, Fundo" />
                      </div>
                  </div>

                  <div id="rural-address-fields" class="hidden fade-in">
                      <label class="block text-sm font-bold text-gray-700 mb-1">Como chegar? (Refer√™ncias) <span class="text-red-500">*</span></label>
                      <textarea id="rural-ref" rows="4" class="w-full rounded-xl border-gray-300 bg-gray-50 focus:bg-white shadow-sm focus:border-[#f45925] focus:ring-[#f45925] py-3" placeholder="Ex: S√≠tio Santo Ant√¥nio, entrada no km 5 da estrada principal, porteira azul."></textarea>
                  </div>
              </div>

              <div class="border-t pt-4 mt-2">
                  <div class="flex items-center gap-2 mb-2">
                     <span class="material-symbols-outlined text-[#f45925]">payments</span>
                     <h3 class="font-bold text-gray-800">Pagamento</h3>
                  </div>
                  <div>
                     <label class="block text-sm font-bold text-gray-700 mb-1">Forma de Pagamento <span class="text-red-500">*</span></label>
                     <select id="payment-method" onchange="toggleTroco()" class="w-full rounded-xl border-gray-300 bg-gray-50 focus:bg-white shadow-sm focus:border-[#f45925] focus:ring-[#f45925] py-3 text-lg">
                         <option value="" disabled selected>Selecione...</option>
                         <option value="Pix">Pix</option>
                         <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito</option>
                         <option value="Cart√£o de D√©bito">Cart√£o de D√©bito</option>
                         <option value="Dinheiro">Dinheiro</option>
                     </select>
                  </div>
                  
                  <div id="troco-div" class="hidden mt-3 fade-in">
                     <label class="block text-sm font-bold text-gray-700 mb-1">Precisa de troco para quanto?</label>
                     <input id="troco-valor" type="text" class="w-full rounded-xl border-gray-300 bg-gray-50 focus:bg-white shadow-sm focus:border-[#f45925] focus:ring-[#f45925] py-3" placeholder="Ex: R$ 50,00" />
                  </div>
              </div>
            </div>

            <button id="send-order" class="w-full bg-[#25D366] hover:bg-[#1ebc57] text-white py-4 rounded-xl font-bold text-lg shadow-lg shadow-green-100 flex items-center justify-center gap-2 transition-transform active:scale-95">
                <span class="material-symbols-outlined">send</span>
                Enviar Pedido via WhatsApp
            </button>
          </div>
        </section>

        <section id="confirmation-section" class="hidden p-4 flex flex-col items-center justify-center min-h-[60vh] text-center bg-white">
            <div class="w-24 h-24 rounded-full bg-green-100 flex items-center justify-center mb-6 animate-bounce">
              <span class="material-symbols-outlined text-green-600 text-5xl">check</span>
            </div>
            <h2 class="text-3xl font-bold text-gray-800 mb-2">Pedido Gerado!</h2>
            <p class="text-gray-500 mb-6 max-w-xs mx-auto">Seu pedido foi aberto no WhatsApp. <strong>Aguarde nossa confirma√ß√£o.</strong></p>
            <button onclick="window.location.reload()" class="px-6 py-3 border border-gray-300 rounded-xl font-bold text-gray-600 hover:bg-gray-50 transition">
              Fazer Novo Pedido
            </button>
        </section>
      </main>

      <div id="floating-cart" class="fixed bottom-4 left-4 right-4 z-40 hidden md:max-w-sm md:mx-auto no-print">
        <button onclick="showSection('cart-section')" class="w-full bg-[#f45925] hover:bg-[#d6421b] text-white p-4 rounded-2xl shadow-2xl flex items-center justify-between transition-all transform hover:scale-[1.02] active:scale-95">
            <div class="flex items-center gap-3">
                <div class="bg-white/20 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold" id="float-count">0</div>
                <span class="font-bold text-lg">Ver Carrinho</span>
            </div>
            <span class="font-bold text-lg" id="float-total">R$ 0,00</span>
        </button>
      </div>

      <div id="toast" class="fixed bottom-24 left-1/2 transform -translate-x-1/2 bg-gray-900/90 backdrop-blur text-white px-6 py-3 rounded-full shadow-2xl flex items-center gap-3 transition-all duration-300 opacity-0 translate-y-10 z-50 pointer-events-none no-print">
        <span class="material-symbols-outlined text-green-400">check_circle</span>
        <span id="toast-msg" class="font-medium text-sm">Item adicionado!</span>
      </div>
    </div>

    <div id="printable-area" class="hidden">
        </div>

    <div id="owner-screen" class="hidden min-h-screen flex flex-col items-center justify-center bg-gray-100 p-4 no-print">
        <div class="bg-white p-6 rounded-2xl shadow-xl max-w-sm w-full text-center">
            <span class="material-symbols-outlined text-[#f45925] text-5xl mb-4">receipt_long</span>
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Imprimir Pedido</h2>
            <p class="text-gray-500 mb-6 text-sm">Clique abaixo para gerar o cupom para a cozinha/motoboy.</p>
            
            <button onclick="window.print()" class="w-full bg-gray-800 text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:bg-gray-700 transition flex items-center justify-center gap-2 mb-3">
                <span class="material-symbols-outlined">print</span> Imprimir Agora
            </button>
            
            <a href="index.html" class="block w-full py-3 text-gray-500 font-bold hover:text-gray-800">
                Ir para o Card√°pio
            </a>
        </div>
    </div>

    <script>
      // ================= CONFIGURA√á√ÉO =================
      const WHATSAPP_PHONE = "5535984687353"; 
      // ================================================

      // Imagens (exemplo)
      const imgCarne = 'https://img.saborosos.com.br/imagens/esfiha-aberta-de-carne-640x480.jpg'; 
      const imgQueijo = 'https://imagem.band.com.br/12/f_355412.jpg'; 
      const imgFrango = 'https://i.ytimg.com/vi/XnLBZe6zm_Q/hq720.jpg?sqp=-oaymwEhCK4FEIIDSFryq4qpAxMIARUAAAAAGAElAADIQj0AgKJD&rs=AOn4CLAciWeLchSAdPcvX7poNmoVqbN3ZQ';
      const imgBacon = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSjenEPWNwsFz4sCVoT5NewpyN54Geuupo0KA&s'
      const imgCalabresa = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSmZQ6bVwC_0ZS_ZMh74nd29pYH8BpwUX7oiA&s';
      const imgAtum = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQjnRnuMaSsR1Gq6y61DgHj6QZnRbd047u45A&s';
      const imgBrocolis = 'https://assets.bibliotecaportatil.com.br/1189/produtos/5-esfiha-aberta-de-brocolis-com-catupiry.jpeg';
      const imgCarneSeca = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRbSU3EkqWoI4RBE-URgmkvoZy7tXxdHj0p3qcnlzLJ06pH-1DQk7kjIiGN4Vb51cSs_fM&usqp=CAU';
      const imgPalmito = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRSOQJmYHP3-zMQbVs04kfIyi6wfca8iBQd6AtZwxwfzibltvkp6rAD1g_xo2ZfgXoaB8o&usqp=CAU';
      const imgQuatroQueijos = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5r3fYXBvjCG2jd-zRUa44w8ai_fvok3RHRejXubYod0q2ZJoMcsciG4xbe-NfpEDXzZc&usqp=CAU';

      const imgDoceChoc = 'https://pontoesfihacampo.konor.app/_core/_uploads/84/2022/08/1338050822973bfjeich.jpg'; 
      const imgRomeuJulieta ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSKZTvVKx4hDMJ6Aoz-fllAhuVXU0KUJJzFxQ&s';
      const imgChocolateBranco = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRdq6AiGpigfV6cQXPlGbIX6jUNONqXx3Qu1w&s';
      const imgPrestigio = 'https://painel.b2f.app/img/estab/f36ac5d3-6d2d-44d7-9ca5-645bcfd58c54/galeria/whatsapp_image_20250331__65d21aa9-5f4c-4e99-afa8-f0529ce1d49f.jpg';
      const imgConfete ='https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ9o26pNj2GNsMGTJtEv_dDER31Gn3SPv7pXw&s';
      const imgBananaCanela = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSZHpW4AiUf_wbBNZhqPeE_5SUiLb26xGQXIA&s';
      const imgDoceLeite = 'https://static.expressodelivery.com.br/imagens/produtos/418984/180/Expresso-Delivery_70e308fbe02cd5e291d111d43947e558.jpg';
      const imgChocMorango = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRMIGBjcPgGo9_oR_yb7AMOf8VOJAXaHeF00L4cYDy9zoHKqgDyL_QivBWxZ2y3qZjL184&usqp=CAU';
      const imgPa√ßoca = 'https://imagens.jotaja.com/produtos/c26b36b2-c925-46a3-980e-6471f2f479e6.jpg';
      const imgNutella = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTES5vX-SCBIXKjrrhsFZ1qX5-1Foiwfpd2RpZZ5HYM64gt6_EF9BnUOcM5d3KZ9nySk7w&usqp=CAU';

      const imgRefriCoca = 'https://alloydeliveryimages.s3.sa-east-1.amazonaws.com/item_images/2649/63813815094641cpzf.webp'; 
      const imgRefriPepsi = 'https://upload.wikimedia.org/wikipedia/commons/thumb/6/68/Vintage_Pepsi_Bottle_Novelty_Transistor_Radio_By_Radio_Shack%2C_Cat._No._12-957%2C_AM_Band%2C_9.5_Inches_Tall%2C_Made_In_Hong_Kong%2C_Circa_1982_%2849450211456%29.jpg/250px-Vintage_Pepsi_Bottle_Novelty_Transistor_Radio_By_Radio_Shack%2C_Cat._No._12-957%2C_AM_Band%2C_9.5_Inches_Tall%2C_Made_In_Hong_Kong%2C_Circa_1982_%2849450211456%29.jpg' ;
      const imgRefriGuarana = 'https://mentemarca.com/wp-content/uploads/2025/07/litrinho-na-mao-feed-885x1024.webp';
      const imgRefriFantaLaranja = 'https://thumbs.dreamstime.com/b/frasco-de-ffnta-budapest-hungary-circa-garrafa-refrigerante-carbonado-laranja-fanta-numa-vidro-pequena-172835371.jpg';
      const aguaComG√°s = 'https://admin.cnnbrasil.com.br/wp-content/uploads/sites/12/2025/01/agua-com-gas.jpg?w=1200&h=900&crop=1';
      const aguaSemG√°s = 'https://andinacocacola.vtexassets.com/arquivos/ids/157883/113325_COCA---Crystal500ml-SemGas.jpg?v=638412015595530000';
      const sucoLaranja = 'https://s2.glbimg.com/E1WXXtiXeTi1DyT5Y1O3uf2DICs=/e.glbimg.com/og/ed/f/original/2019/01/15/31617293018_896bf29d55_k.jpg';
      const sucoLim√£o = 'https://www.solufition.com.br/img/users/1/dUoxdJhQSrlEcCs2xUfhcWeaTVadbqy8wN6u9dxJ.jpg';
      const sucoMamao = 'https://www.graciemag.com/wp-content/uploads/2014/01/papaya-1024x726.jpg';
      const cervejaHeiniken = 'https://images.unsplash.com/photo-1599419685838-28e405ea05b9?fm=jpg&q=60&w=3000&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8aGVpbmVrZW58ZW58MHx8MHx8fDA%3D';
      const chop = 'https://cdn.awsli.com.br/600x450/2613/2613735/produto/220435192/chopp-m07cjb58az.JPG';

      const imgComboIndividual = 'https://cdn.neemo.com.br/uploads/item/photo/2389566/photo1715179540.jpeg.webp';
      const imgComboCasal = 'https://img.deliverydireto.com.br/unsafe/origxorig/https://duisktnou8b89.cloudfront.net/img/items/combo-com-10-esfihas-salgadas-5-off6848a1fb87361.jpg'; 
      const imgComboFamilia = 'https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRsgbK5qHsKO6dBDaqJMNPbbA7RJ1A7sd7Y_sVYrARH1-GBp0cf8r1mlqF25y1oBSRO3iM&usqp=CAU'; 
      const imgComboDegus = 'https://img.deliverydireto.com.br/unsafe/origxorig/https://duisktnou8b89.cloudfront.net/img/items/67e16bc12d9fe.png'; 
      const imgComboKids = 'https://cdn.neemo.com.br/uploads/item/photo/2521155/photo1728520664.jpeg.webp'; 
      
      const products = [
        // --- SALGADAS ---
        { id: 'salg1', category: 'salgadas', name: 'Carne Tradicional', price: 4.50, desc: 'Carne mo√≠da temperada com lim√£o, tomate e cebola.', img: imgCarne },
        { id: 'salg2', category: 'salgadas', name: 'Queijo', price: 4.50, desc: 'Mussarela derretida com or√©gano.', img: imgQueijo },
        { id: 'salg3', category: 'salgadas', name: 'Calabresa', price: 4.50, desc: 'Calabresa fatiada com cebola.', img: imgCalabresa },
        { id: 'salg4', category: 'salgadas', name: 'Frango c/ Catupiry', price: 5.50, desc: 'Frango desfiado com Catupiry original.', img: imgFrango },
        { id: 'salg5', category: 'salgadas', name: 'Bacon', price: 5.50, desc: 'Mussarela com peda√ßos crocantes de bacon.', img: imgBacon },
        { id: 'salg6', category: 'salgadas', name: 'Carne Seca', price: 6.00, desc: 'Carne seca desfiada com cream cheese.', img: imgCarneSeca },
        { id: 'salg7', category: 'salgadas', name: 'Atum', price: 6.00, desc: 'Atum s√≥lido com cebola e mussarela.', img: imgAtum },
        { id: 'salg8', category: 'salgadas', name: 'Palmito', price: 6.00, desc: 'Palmito picado com mussarela.', img: imgPalmito },
        { id: 'salg9', category: 'salgadas', name: 'Quatro Queijos', price: 6.50, desc: 'Mussarela, provolone, parmes√£o e catupiry.', img: imgQuatroQueijos },
        { id: 'salg10', category: 'salgadas', name: 'Br√≥colis', price: 5.50, desc: 'Br√≥colis refogado ao alho com queijo.', img: imgBrocolis },

        // --- DOCES ---
        { id: 'doce1', category: 'doces', name: 'Chocolate Ao Leite', price: 7.00, desc: 'Chocolate cremoso derretido.', img: imgDoceChoc },
        { id: 'doce2', category: 'doces', name: 'Chocolate Branco', price: 7.00, desc: 'Chocolate branco nobre.', img: imgChocolateBranco },
        { id: 'doce3', category: 'doces', name: 'Romeu e Julieta', price: 7.50, desc: 'Goiabada com queijo minas.', img: imgRomeuJulieta },
        { id: 'doce4', category: 'doces', name: 'Prest√≠gio', price: 7.50, desc: 'Chocolate com coco ralado.', img: imgPrestigio },
        { id: 'doce5', category: 'doces', name: 'Confete', price: 7.50, desc: 'Chocolate coberto com M&Ms.', img: imgConfete },
        { id: 'doce6', category: 'doces', name: 'Banana c/ Canela', price: 6.50, desc: 'Banana, a√ß√∫car, canela e mussarela.', img: imgBananaCanela },
        { id: 'doce7', category: 'doces', name: 'Doce de Leite', price: 7.00, desc: 'Doce de leite mineiro.', img: imgDoceLeite },
        { id: 'doce8', category: 'doces', name: 'Morango c/ Choc', price: 8.50, desc: 'Morangos frescos com chocolate.', img: imgChocMorango },
        { id: 'doce9', category: 'doces', name: 'Pa√ßoca', price: 7.50, desc: 'Doce de leite com pa√ßoca esfarelada.', img: imgPa√ßoca },
        { id: 'doce10', category: 'doces', name: 'Nutella', price: 9.00, desc: 'Pura Nutella original.', img: imgNutella },

        // --- BEBIDAS ---
        { id: 'beb1', category: 'bebidas', name: 'Coca-Cola', price: 6.00, desc: '350ml', img: imgRefriCoca },
        { id: 'beb2', category: 'bebidas', name: 'Pepsi', price: 14.00, desc: 'Garrafa', img: imgRefriPepsi },
        { id: 'beb3', category: 'bebidas', name: 'Guaran√°', price: 6.00, desc: '350ml', img: imgRefriGuarana },
        { id: 'beb4', category: 'bebidas', name: 'Fanta Laranja', price: 12.00, desc: 'Garrafa', img: imgRefriFantaLaranja },
        { id: 'beb5', category: 'bebidas', name: '√Ågua s/ G√°s', price: 4.00, desc: '500ml', img: aguaSemG√°s },
        { id: 'beb6', category: 'bebidas', name: '√Ågua c/ G√°s', price: 4.50, desc: '500ml', img: aguaComG√°s },
        { id: 'beb7', category: 'bebidas', name: 'Suco Laranja', price: 9.00, desc: 'Natural 400ml', img: sucoLaranja },
        { id: 'beb8', category: 'bebidas', name: 'Suco Lim√£o', price: 9.00, desc: 'Natural 400ml', img: sucoLim√£o },
        { id: 'beb9', category: 'bebidas', name: 'Suco Mam√£o', price: 9.00, desc: 'Natural 400ml', img: sucoMamao },
        { id: 'beb9', category: 'bebidas', name: 'Heineken Long Neck', price: 10.00, desc: '330ml', img: cervejaHeiniken },
        { id: 'beb10', category: 'bebidas', name: 'Chop', price: 7.00, desc: 'Skol/Brahma 350ml', img: chop },

        // --- COMBOS ---
        { id: 'com1', category: 'combos', name: 'Combo Individual', price: 25.00, desc: '4 Esfihas Carne + 1 Refri Lata', img: imgComboIndividual},
        { id: 'com2', category: 'combos', name: 'Combo Casal', price: 45.00, desc: '8 Esfihas (Cl√°ssicas) + 1 Refri 2L', img: imgComboCasal },
        { id: 'com3', category: 'combos', name: 'Combo Fam√≠lia', price: 80.00, desc: '20 Esfihas (15 Salg / 5 Doces) + Refri', img: imgComboFamilia },
        { id: 'com4', category: 'combos', name: 'Combo Degusta√ß√£o', price: 35.00, desc: '6 Esfihas Gourmet Variadas', img: imgComboDegus },
        { id: 'com5', category: 'combos', name: 'Combo Kids', price: 22.00, desc: '2 Carne, 1 Chocolate + Suco', img: imgComboKids },
      ];

      // --- ESTADO ---
      let currentCategory = 'salgadas';
      let orderType = 'delivery'; 
      const cart = {};

      function formatPrice(v){ return 'R$ ' + v.toFixed(2).replace('.',','); }

      // --- HTML DO BOT√ÉO ---
      function getButtonHtml(id, qty) {
        if(qty > 0) {
            return `
              <div class="flex items-center gap-3 bg-gray-50 rounded-lg p-1 border border-gray-200 shadow-inner">
                  <button onclick="changeQty('${id}', -1)" class="w-8 h-8 flex items-center justify-center text-[#f45925] font-bold text-xl hover:bg-white rounded-md transition shadow-sm">-</button>
                  <span class="font-bold text-gray-800 w-4 text-center">${qty}</span>
                  <button onclick="changeQty('${id}', 1)" class="w-8 h-8 flex items-center justify-center bg-[#f45925] text-white font-bold text-xl rounded-md transition hover:bg-[#d6421b] shadow-sm">+</button>
              </div>
            `;
        } else {
            return `
              <button onclick="addToCart('${id}')" class="bg-gray-50 hover:bg-[#f45925] hover:text-white text-[#f45925] border border-gray-200 hover:border-[#f45925] rounded-lg px-3 py-1.5 text-sm font-bold transition-all shadow-sm">
                Adicionar
              </button>
            `;
        }
      }

      // --- RENDERIZA√á√ÉO MENU ---
      function renderProducts(categoryFilter = currentCategory){
        currentCategory = categoryFilter; 
        const container = document.getElementById('products');
        container.innerHTML = '';
        
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.classList.remove('bg-[#f45925]', 'text-white', 'shadow-md');
            btn.classList.add('bg-white', 'text-gray-600', 'border', 'border-gray-200');
        });
        const activeTab = document.getElementById('tab-'+categoryFilter);
        if(activeTab){
            activeTab.classList.remove('bg-white', 'text-gray-600', 'border', 'border-gray-200');
            activeTab.classList.add('bg-[#f45925]', 'text-white', 'shadow-md');
        }

        const filtered = products.filter(p => p.category === categoryFilter);

        if(filtered.length === 0){
           container.innerHTML = `<div class="col-span-2 text-center text-gray-400 py-10">Nenhum item encontrado.</div>`;
           return;
        }

        filtered.forEach(p => {
          const qty = cart[p.id] ? cart[p.id].qty : 0;
          
          const card = document.createElement('div');
          card.id = `card-${p.id}`; 
          card.className = 'flex flex-row bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden fade-in hover:shadow-md transition-shadow h-36 md:h-40';
          
          card.innerHTML = `
            <img src="${p.img}" 
                 alt="${p.name}"
                 onerror="this.onerror=null; this.src='https://placehold.co/300x300?text=Foto+Indispon√≠vel';"
                 class="w-28 md:w-36 h-full object-cover shrink-0 bg-gray-200">
            
            <div class="flex-1 p-3 flex flex-col justify-between relative min-w-0">
              <div>
                <h3 class="font-bold text-gray-800 leading-tight text-base truncate">${p.name}</h3>
                <p class="text-xs text-gray-500 mt-1 line-clamp-2 leading-relaxed">${p.desc}</p>
              </div>
              <div class="flex items-center justify-between mt-2">
                <span class="font-bold text-[#f45925] text-lg">${formatPrice(p.price)}</span>
                
                <div id="btn-wrap-${p.id}">
                    ${getButtonHtml(p.id, qty)}
                </div>
              </div>
            </div>
          `;
          container.appendChild(card);
        });
      }

      function updateCartCount(){
        const items = Object.values(cart);
        const count = items.reduce((s,i)=>s+i.qty,0);
        const total = items.reduce((s,i)=>s+(i.price*i.qty),0);

        const badge = document.getElementById('cart-count');
        badge.textContent = count;
        badge.classList.toggle('hidden', count === 0);

        const floatBtn = document.getElementById('floating-cart');
        if(count > 0 && document.getElementById('cart-section').classList.contains('hidden')){
            floatBtn.classList.remove('hidden');
            document.getElementById('float-count').textContent = count;
            document.getElementById('float-total').textContent = formatPrice(total);
        } else {
            floatBtn.classList.add('hidden');
        }
      }

      function showToast(msg){
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toast-msg');
        toastMsg.textContent = msg;
        toast.classList.remove('opacity-0', 'translate-y-10');
        setTimeout(() => {
           toast.classList.add('opacity-0', 'translate-y-10');
        }, 2000);
      }

      // --- LOGICA DO CARRINHO ---
      window.addToCart = function(id){
        window.changeQty(id, 1);
      }

      window.changeQty = function(id, delta){
        const p = products.find(x=>x.id===id);
        if(!p) return;

        if(!cart[id]) {
            if (delta > 0) cart[id] = { ...p, qty: 1 };
        } else {
            cart[id].qty += delta;
            if(cart[id].qty <= 0) delete cart[id];
        }
        
        updateCartCount();

        const btnWrap = document.getElementById(`btn-wrap-${id}`);
        if(btnWrap) {
            const newQty = cart[id] ? cart[id].qty : 0;
            btnWrap.innerHTML = getButtonHtml(id, newQty);
        }

        if(!document.getElementById('cart-section').classList.contains('hidden')) {
            renderCart(); 
        }

        if(delta > 0) showToast(`Atualizado: ${p.name}`);
      }

      function renderCart(){
        const el = document.getElementById('cart-items');
        el.innerHTML = '';
        const items = Object.values(cart);
        
        document.getElementById('floating-cart').classList.add('hidden');

        if(items.length===0){ 
            el.innerHTML = `<div class="flex flex-col items-center justify-center py-12 text-gray-400 space-y-3">
              <span class="material-symbols-outlined text-4xl opacity-50">shopping_basket</span>
              <p>Seu carrinho est√° vazio.</p>
            </div>`; 
            document.getElementById('subtotal').textContent = 'R$ 0,00';
            document.getElementById('total').textContent = 'R$ 0,00';
            return; 
        }

        let subtotal = 0;
        items.forEach(item=>{
          subtotal += item.price * item.qty;
          const row = document.createElement('div');
          row.className = 'flex items-center gap-3 bg-white p-2 rounded-xl border border-gray-100 shadow-sm';
          row.innerHTML = `
            <img src="${item.img}" 
                 onerror="this.src='https://placehold.co/100x100?text=No+Img'"
                 class="w-16 h-16 object-cover rounded-lg shrink-0 bg-gray-200">
            
            <div class="flex-1 min-w-0">
              <div class="font-bold text-gray-800 text-sm truncate">${item.name}</div>
              <div class="text-xs text-[#f45925] font-semibold mt-0.5">${formatPrice(item.price)}</div>
            </div>
            <div class="flex items-center gap-2 bg-gray-50 rounded-lg p-1 border border-gray-200">
              <button onclick="changeQty('${item.id}', -1)" class="w-7 h-7 flex items-center justify-center bg-white rounded shadow-sm text-gray-600 font-bold text-lg hover:bg-gray-100">-</button>
              <span class="font-medium text-sm w-5 text-center">${item.qty}</span>
              <button onclick="changeQty('${item.id}', 1)" class="w-7 h-7 flex items-center justify-center bg-[#f45925] text-white rounded shadow-sm font-bold text-lg hover:bg-[#d6421b]">+</button>
            </div>
          `;
          el.appendChild(row);
        });
        document.getElementById('subtotal').textContent = formatPrice(subtotal);
        document.getElementById('total').textContent = formatPrice(subtotal);
      }

      // --- CONTROLE DE ENTREGA / RETIRADA ---
      window.setOrderType = function(type) {
          orderType = type;
          const btnDel = document.getElementById('btn-delivery');
          const btnPick = document.getElementById('btn-pickup');
          const addressGroup = document.getElementById('delivery-address-group');

          if(type === 'delivery') {
              btnDel.className = "p-4 rounded-xl border-2 border-[#f45925] bg-[#f45925] text-white font-bold flex flex-col items-center gap-2 transition-all shadow-md";
              btnPick.className = "p-4 rounded-xl border border-gray-200 bg-white text-gray-500 font-bold flex flex-col items-center gap-2 hover:bg-gray-50 transition-all";
              addressGroup.classList.remove('hidden');
          } else {
              btnDel.className = "p-4 rounded-xl border border-gray-200 bg-white text-gray-500 font-bold flex flex-col items-center gap-2 hover:bg-gray-50 transition-all";
              btnPick.className = "p-4 rounded-xl border-2 border-[#f45925] bg-[#f45925] text-white font-bold flex flex-col items-center gap-2 transition-all shadow-md";
              addressGroup.classList.add('hidden');
          }
      }

      // --- CONTROLE RURAL ---
      window.toggleRural = function() {
          const isRural = document.getElementById('rural-check').checked;
          const urbanFields = document.getElementById('urban-address-fields');
          const ruralFields = document.getElementById('rural-address-fields');
          
          if(isRural) {
              urbanFields.classList.add('hidden');
              ruralFields.classList.remove('hidden');
          } else {
              urbanFields.classList.remove('hidden');
              ruralFields.classList.add('hidden');
          }
      }
      
      // --- CONTROLE ENDERE√áO MANUAL (SEM CEP) ---
      window.enableManualAddress = function() {
          const fields = ['address-street', 'address-district', 'address-city'];
          fields.forEach(id => {
              const el = document.getElementById(id);
              el.removeAttribute('readonly');
              el.classList.remove('bg-gray-100', 'text-gray-500');
              el.classList.add('bg-white', 'focus:ring-[#f45925]');
          });
          document.getElementById('address-cep').value = '';
          document.getElementById('address-street').focus();
          document.getElementById('address-city').placeholder = "Digite a cidade";
          document.getElementById('address-district').placeholder = "Digite o bairro";
          document.getElementById('address-street').placeholder = "Digite o nome da rua";
      }

      // --- NAVEGA√á√ÉO ---
      window.setCategory = function(cat) { renderProducts(cat); }

      window.showSection = function(id){
        ['home-section','menu-section','cart-section','confirmation-section'].forEach(s=>{
          document.getElementById(s).classList.toggle('hidden', s!==id);
        });
        window.scrollTo(0,0);
        
        if(id === 'menu-section') { renderProducts(currentCategory); updateCartCount(); }
        if(id === 'cart-section') renderCart();
        if(id === 'home-section') document.getElementById('floating-cart').classList.add('hidden');
      }

      document.getElementById('cta-menu').onclick = ()=> showSection('menu-section');
      document.getElementById('btn-menu').onclick = ()=> showSection('menu-section');
      document.getElementById('btn-cart').onclick = ()=> showSection('cart-section');

      // --- PAGAMENTO E CEP ---
      window.toggleTroco = function() {
        const metodo = document.getElementById('payment-method').value;
        const divTroco = document.getElementById('troco-div');
        if (metodo === 'Dinheiro') {
            divTroco.classList.remove('hidden');
        } else {
            divTroco.classList.add('hidden');
            document.getElementById('troco-valor').value = ''; 
        }
      }

      window.buscarCep = function() {
        let cep = document.getElementById('address-cep').value.replace(/\D/g, '');
        if (cep.length === 8) {
          fetch(`https://viacep.com.br/ws/${cep}/json/`)
            .then(res => res.json())
            .then(data => {
              if (!data.erro) {
                document.getElementById('address-city').value = `${data.localidade}/${data.uf}`;
                const streetInput = document.getElementById('address-street');
                if (data.logradouro) {
                    streetInput.value = data.logradouro;
                    streetInput.setAttribute('readonly', true);
                    streetInput.classList.add('bg-gray-100');
                } else {
                    streetInput.value = "";
                    streetInput.removeAttribute('readonly');
                    streetInput.focus(); 
                }
                const districtInput = document.getElementById('address-district');
                if (data.bairro) {
                    districtInput.value = data.bairro;
                    districtInput.setAttribute('readonly', true);
                    districtInput.classList.add('bg-gray-100');
                } else {
                    districtInput.value = "";
                    districtInput.removeAttribute('readonly');
                }
                document.getElementById('cep-error').classList.add('hidden');
                
                const txtValor = document.getElementById('valor-entrega');
                if(data.localidade === 'Camanducaia') {
                   txtValor.textContent = "R$ 5,00"; 
                } else {
                   txtValor.textContent = "A combinar"; 
                }

                if(data.logradouro) document.getElementById('address-number').focus();

              } else {
                alert("CEP n√£o encontrado! Tente digitar o endere√ßo manualmente.");
                document.getElementById('cep-error').classList.remove('hidden');
                enableManualAddress();
              }
            })
            .catch(() => {
                alert("Erro ao buscar CEP. Digite manualmente.");
                enableManualAddress();
            });
        }
      }

      // --- FINALIZAR PEDIDO (LINK M√ÅGICO) ---
      document.getElementById('send-order').onclick = ()=>{
        const items = Object.values(cart);
        if(items.length===0){ showToast('Carrinho vazio!'); return; }
        
        const nome = document.getElementById('customer-name').value.trim();
        const pagamento = document.getElementById('payment-method').value;
        const troco = document.getElementById('troco-valor').value.trim();
        
        if(!nome) { alert('Por favor, informe seu Nome.'); return; }
        if(!pagamento) { alert('Selecione a forma de pagamento.'); return; }

        const totalVal = items.reduce((s,i)=>s + i.qty*i.price,0);

        // -- DADOS PARA O CUPOM --
        let addressText = ""; 
        let deliveryData = {};

        if(orderType === 'delivery') {
            const isRural = document.getElementById('rural-check').checked;
            
            if (isRural) {
                const ruralRef = document.getElementById('rural-ref').value.trim();
                if(!ruralRef) { alert('Informe refer√™ncias!'); return; }
                
                addressText = `ENTREGA RURAL\nRef: ${ruralRef}`;
                deliveryData = { type: 'rural', ref: ruralRef };
            } else {
                const cep = document.getElementById('address-cep').value.trim();
                const rua = document.getElementById('address-street').value.trim();
                const numero = document.getElementById('address-number').value.trim();
                const bairro = document.getElementById('address-district').value.trim();
                const complemento = document.getElementById('address-complement').value.trim();
                const cidade = document.getElementById('address-city').value.trim();
                
                if (!rua) { alert('Preencha o campo rua!'); return; }
                else if (!numero) { alert('Preencha o campo n√∫mero!'); return; }
                else if (!bairro) { alert('Preencha o campo bairro!'); return; }

                addressText = `${rua}, ${numero}\n${bairro} - ${cidade}\nObs: ${complemento || '-'}`;
                deliveryData = { type: 'urban', rua, numero, bairro, cidade, comp: complemento };
            }
        } else {
            addressText = "RETIRADA NO BALC√ÉO";
            deliveryData = { type: 'pickup' };
        }

        // -- GERAR LINK M√ÅGICO --
        // Empacota tudo num objeto
        const orderObject = {
            customer: nome,
            items: items.map(i => ({q: i.qty, n: i.name, p: i.price})),
            total: totalVal,
            address: addressText,
            payment: pagamento + (troco ? ` (Troco: ${troco})` : ''),
            date: new Date().toLocaleString('pt-BR')
        };

        // Cria o link seguro para o WhatsApp
        const jsonStr = JSON.stringify(orderObject);
        const encodedData = encodeURIComponent(jsonStr);
        const magicLink = `${window.location.href.split('?')[0]}?print_data=${encodedData}`;

        // -- MENSAGEM WHATSAPP --
        let msg = "";
        msg += `*NOVO PEDIDO - ${orderType === 'delivery' ? 'DELIVERY' : 'RETIRADA'}* üçï\n\n`;
        msg += `*Cliente:* ${nome}\n`;
        msg += `--------------------------------\n`;
        items.forEach(item => msg += `${item.qty}x ${item.name}\n`);
        msg += `--------------------------------\n`;
        msg += `*Total:* ${formatPrice(totalVal)}\n\n`;
        
        if(orderType === 'delivery') {
             msg += `*Endere√ßo:* \n${addressText}\n\n`;
        } else {
             msg += `*Vou retirar no balc√£o.*\n\n`;
        }
        
        msg += `*Pagamento:* ${pagamento} ${troco ? '(Troco: '+troco+')' : ''}\n`;
        msg += `--------------------------------\n`;
        msg += `üñ® *LINK PARA IMPRIMIR CUPOM:*\n${magicLink}`;

        const url = `https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(msg)}`;
        
        for(const k in cart) delete cart[k]; 
        updateCartCount();
        
        showSection('confirmation-section');
        window.open(url, '_blank');
      };

      // --- LEITOR DE LINK M√ÅGICO (AO CARREGAR A P√ÅGINA) ---
      window.onload = function() {
          const params = new URLSearchParams(window.location.search);
          const printData = params.get('print_data');

          if(printData) {
              try {
                  // Decodifica os dados
                  const data = JSON.parse(decodeURIComponent(printData));
                  
                  // Esconde o app normal
                  document.getElementById('app-content').classList.add('hidden');
                  document.getElementById('owner-screen').classList.remove('hidden');

                  // Monta o HTML do Cupom
                  let cupomHTML = `
                    <div style="text-align:center; border-bottom: 1px dashed #000; padding-bottom: 10px; margin-bottom: 10px;">
                        <h2 style="margin:0; font-size: 16px; font-weight:bold;">ESFIHARIA SABOR</h2>
                        <p style="margin:0; font-size: 10px;">${data.date}</p>
                    </div>
                    
                    <div style="margin-bottom: 10px; font-weight:bold;">
                        CLIENTE: ${data.customer.toUpperCase()}
                    </div>

                    <table style="width:100%; font-size: 12px; margin-bottom: 10px; border-collapse: collapse;">
                        <tr style="border-bottom: 1px solid #000;">
                            <th style="text-align:left; padding: 2px 0;">Qtd</th>
                            <th style="text-align:left; padding: 2px 0;">Item</th>
                            <th style="text-align:right; padding: 2px 0;">R$</th>
                        </tr>
                  `;

                  data.items.forEach(item => {
                      cupomHTML += `
                        <tr>
                            <td style="padding: 2px 0;">${item.q}x</td>
                            <td style="padding: 2px 0;">${item.n}</td>
                            <td style="text-align:right; padding: 2px 0;">${(item.p * item.q).toFixed(2)}</td>
                        </tr>
                      `;
                  });

                  cupomHTML += `
                    </table>
                    
                    <div style="text-align:right; font-size: 14px; font-weight:bold; border-top: 1px dashed #000; padding-top: 5px; margin-bottom: 10px;">
                        TOTAL: R$ ${data.total.toFixed(2).replace('.',',')}
                    </div>

                    <div style="border: 1px solid #000; padding: 5px; margin-bottom: 10px;">
                        <strong style="font-size: 11px;">ENDERE√áO / OBS:</strong><br>
                        <span style="font-size: 12px;">${data.address.replace(/\n/g, '<br>')}</span>
                    </div>
                    
                    <div style="font-weight:bold; font-size: 12px;">
                        PAGAMENTO: ${data.payment}
                    </div>
                    
                    <div style="text-align:center; margin-top: 20px; font-size: 10px;">
                        --- Fim do Pedido ---
                    </div>
                  `;

                  // Injeta na √°rea de impress√£o
                  document.getElementById('printable-area').innerHTML = cupomHTML;

                  // Se quiser imprimir direto ao abrir:
                  // window.print();

              } catch(e) {
                  alert('Erro ao ler dados do pedido. Link inv√°lido.');
                  window.location.href = window.location.href.split('?')[0]; // Volta pra home limpa
              }
          } else {
              // Carregamento normal da loja
              renderProducts('salgadas');
          }
      };
    </script>
  </body>
</html>